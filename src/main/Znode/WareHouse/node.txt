ODS层:在MySQL直接导入
    日志 log

    业务 db

DWD层:
  log: 导入 分区表
        insert overwrite table dwd_start_log partition(dt = '2020-07-25')
    过滤字段
    启动 start
    页面 page
    动作 action
    曝光 display
    错误 error

    解析json ： get_json_object(line,'$common.ar') 利用json美化工具

    from ods_log
    where dt='2020-07-25'
    and get_json_object(line,'$.start') is not null;

  db:维度模型 分区表
    维度表：

    事实表：
ODS
原始数据
字典表(查询编号代表含义)
DWD
日志表:都包含公共信息 user_id, mid_id,brand,model, channel,os,  area_code
    `area_code`'地区编码',
    `brand`'手机品牌',
    `channel`'渠道',
    `model`'手机型号',
    `mid_id`'设备id',
    `os`'操作系统',
    `user_id` '会员id',········

维度表:
dwd_dim_user_info_his 用户维度表  拉链表(适用于量大,有变化且变化慢的表)
 用户维度 记录用户相关信息 id(姓名/生日/性别·····)(等级/创建时间,操作时间)有效开始时间/有效截止时间9999-99-99
dwd_dim_sku_info 商品维度表(全量)
 商品维度 id、sku、spu，名称价格,一二三级分类·····
dwd_dim_coupon_info 优惠卷维度表(全量)  对应优惠券领用事实表
 优惠券维度 id 编号名称类型 适用范围 可用次数 最大领用次数 过期时间·····
dwd_dim_activity_info 活动维度表(全量)
 活动维度 id  编号名称类型  开始/结束时间 创建时间(在开始时间之前 相当于活动预告时间)
dwd_dim_base_province 地区维度表(特殊)
 地区维度  地区相关
dwd_dim_date_info 时间维度表(特殊)只输入一次
 时间维度 手动创建插入  时间相关 可提前自定义编辑1年等
事实表:
dwd_fact_order_detail 订单明细事实表(事务型d)
包含订单信息，粒度精确到商品  主键id 订单编号(对应订单事实表)，一个用户,一件商品 (价格名称skuid价格数量····) 创建时间、度量值为此商品在订单中的各价格分摊
dwd_fact_order_info 订单事实表 累积型快照(对应着新增及变化)
 粒度为一条订单及订单状态  --主键id订单编号(对应订单明细事实表)，一个用户,N个商品,省份id,活动id 支付流水号 订单(创建/支付/取消/完成/退款)  度量值：总价 优惠价 运费 最终价
dwd_fact_payment_info 支付事实表
对应一条支付信息，以 用户、时间、地区 维度进行分析，支付必定对应自己的支付编号(主键)、一条订单、一个用户、N个商品、支付地区、支付类型等，度量值为支付金额
dwd_fact_refund_info 退款事实表
对应一条退款信息，以 用户、时间、地区 维度进行分析。主键为id编号，一个用户、某条订单、一件商品、时间，以及退款类型，退款原因类型，度量值件数金额
dwd_fact_comment_info 评论事实表
对应一条评论信息，以 商品、用户、时间 维度进行分析，对应一个用户，一件商品及其对应订单，一个时间，
dwd_fact_cart_info 加购事实表  周期型快照(对应着ODS为增量表)
对应每日的加购物车留存信息，以商品、用户、时间、维度进行分析，且只关心当日购物车商品存量，不关心加购与取消加购操作信息，如果想分析加购次数可关联用户活动日志表
dwd_fact_favor_info 收藏事实表 周期型快照(对应着ODS为增量表)
对应每日的加收藏商品的留存信息，以商品、用户、时间、维度进行分析，且只关心当日被收藏商品存量，不关心加收藏与取消收藏操作信息，如果想分析收藏次数可关联用户活动日志表
dwd_fact_conpon_use 优惠卷领用事实表 累积型快照(对应着新增及变化)
对应一个优惠券的使用信息，对应一个优惠券，一条订单，以及领取，使用时间(下单时间)，支付时间等
DWS：宽表  --是站在不同维度的视角去看事实表
DWS都是按分区进行计算 本项目为 天指标
每日设备行为表 dws_uv_detail_daycount      设备维度 分析 某设备 当日活跃次数  页面访问统计
    --最基本的统计,设备当日活跃及访问记录等   设备登录未必创建用户  但不注册用户无法下单/支付等 故未统计
每日会员行为表 dws_user_action_daycount    用户维度 分析 用户当日 (登录/加购/下单/支付) (次数/金额)  下单明细
    --用户角度  可下单/支付/退款 |加购物车/收藏/领券|等    故统计其 次数/金额等
每日商品行为表 dws_sku_action_daycount     商品维度 分析 商品当日被 (下单/支付/退款/加购/收藏) (好/中/差/默认 评价)次数
    --商品角度  可被下单/支付/退货/加购/收藏等 的次数/金额   以及被各级评级次数
每日活动统计表 dws_activity_info_daycount  活动维度 分析 活动当日 (开始/结束/创建 时间) (曝光/下单/支付 次数/金额)
    --记录活动相关信息   统计活动 被 曝光/下单/支付 次数/金额
每日地区统计表 dws_area_stats_daycount     地区维度 分析 (地区/省份) (下单/支付) (次数/金额)
    --记录地区相关信息   根据地区统计下单/支付 的 次数/金额   想分析其他 比如加购收藏次数等 关联用户行为日志
DWT 不分区 大宽表
设备主题宽表  dwt_uv_topic        mid_id,brand,model    某设备 首末活跃时间  当日/累计活跃
会员主题宽表  dwt_user_topic      user_id               用户   (首末/近30天/累计)  (登录/下单/支付)  的 (次数/金额)
商品主题宽表  dwt_sku_topic       sku_id                商品   (近30天/累计)  被  (下单/支付/退款)  的 (次数/金额)
活动主题宽表  dwt_activity_topic  活动id                 活动 (当日/累计)  被  (曝光/下单/支付)  的(次数/金额)
地区主题宽表  dwt_area_topic      地区id                 某地区  (当天/近30天)  (活跃设备/下单/支付) 的 (次数/金额)
 业务术语
1、用户：用户以设备为判断标准，在移动统计中，每个独立设备认为是一个独立用户。Android 系统根据 IMEI 号，IOS 系统根据 OpenUDID 来标识一个独立用户，每部手机一个用户。
2、新增用户：
首次联网使用应用的用户。如果一个用户首次打开某 APP，那这个用户定义为新增用 户；卸载再安装的设备，不会被算作一次新增。新增用户包括日新增用户、周新增用户、月 新增用户。
3、活跃用户
打开应用的用户即为活跃用户，不考虑用户的使用情况。每天一台设备打开多次会被计为一个活跃用户。
4、周(月)活跃用户
某个自然周(月)内启动过应用的用户，该周(月)内的多次启动只记一个活跃用户。
5、月活跃率
月活跃用户与截止到该月累计的用户总和之间的比例。
6、沉默用户
用户仅在安装当天(次日)启动一次，后续时间无再启动行为。该指标可以反映新增用户质量和用户与 APP 的匹配程度。
7、版本分布
不同版本的周内各天新增用户数，活跃用户数和启动次数。利于判断 APP 各个版本之间的优劣和用户行为习惯。
8、本周回流用户
上周未启动过应用，本周启动了应用的用户。
9、连续 n 周活跃用户
连续 n 周，每周至少启动一次。
10、忠诚用户
连续活跃 5 周以上的用户。
11、连续活跃用户
连续 2 周及以上活跃的用户。
12、近期流失用户
连续 n(2<=n<=4)周没有启动应用的用户。(第 n+1 周没有启动过)
13、留存用户
某段时间内的新增用户，经过一段时间后，仍然使用应用的被认作是留存用户；这部分用户占当时新增用户的比例即是留存率。
例如，5 月份新增用户 200，这 200 人在 6 月份启动过应用的有 100 人，7 月份启动过 应用的有 80 人， 8 月份启动过应用的有 50 人；则 5 月份新增用户一个月后的留存率是 50%， 二个月后的留存率是 40%，三个月后的留存率是 25%。
14、用户新鲜度
每天启动应用的新老用户比例，即新增用户数占活跃用户数的比例。
15、单次使用时长
每次启动使用的时间长度。
16、日使用时长
累计一天内的使用时间长度。
17、启动次数计算标准 IOS 平台应用退到后台就算一次独立的启动；
Android 平台我们规定，两次启动之间的 间隔小于 30 秒，被计算一次启动。用户在使用过程中，若因收发短信或接电话等退出应用 30 秒又再次返回应用中，那这两次行为应该是延续而非独立的，所以可以被算作一次使用 行为，即一次启动。业内大多使用 30 秒这个标准，但用户还是可以自定义此时间间隔。

